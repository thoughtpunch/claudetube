# Ralph Progress Log

## 2026-02-03

### claudetube-amqw: MCP server cache resolution differs from direct Python
**Status:** Closed (Already Fixed)

Investigated the reported bug where MCP tool calls returned "Video not found" while direct Python worked.

**Finding:** The bug was already fixed in commit f5257a9 (claudetube-q241).

**Root cause:** SQLite returned stale `cache_path` values that no longer existed on disk after videos were moved to hierarchical paths.

**Fix applied (in f5257a9):**
- SQLite lookup now verifies `state.json` exists before trusting the cache_path
- Falls back to flat path check and glob scan if SQLite path is stale
- Added `require_cached()` method for MCP tools to fail fast with clear errors
- `list_cached_videos()` now combines SQL + filesystem results

**Verification:**
- Tested MCP tool call: `get_transcript('aircAruvnKk')` → SUCCESS
- Tested direct Python: `asyncio.run(get_transcript('aircAruvnKk', 'txt'))` → SUCCESS
- Both return 18,505 char transcript correctly
- 2026-02-03 17:04 | claudetube-58qv [P1] | JSON parse error on URLs with playlist params
- 2026-02-03 17:09 | claudetube-r5zk [P2] | Fix 5 failing tests in entity_extraction and visual_transcript operations
- 2026-02-03 17:16 | claudetube-51tz [P2] | Playlist ID not captured from URL
- 2026-02-03 17:24 | claudetube-it5q [P2] | Add force flag to process_video_tool
- 2026-02-03 17:28 | claudetube-lx2j [P2] | Whisper SRT segments too long (30+ seconds)
- 2026-02-03 17:34 | claudetube-amqw [P0] | MCP server cache resolution differs from direct Python
- 2026-02-03 17:41 | claudetube-3zd7 [P0] | Use YouTube subtitles before Whisper (Cheap First)
- 2026-02-03 17:53 | claudetube-amqw [P0] | MCP server cache resolution differs from direct Python
- 2026-02-03 23:53 | claudetube-amqw [P0] | VERIFIED CLOSED - Bug was fixed in e1a1f29, confirmed MCP and direct Python both work
- 2026-02-03 17:56 | claudetube-58qv [P1] | JSON parse error on URLs with playlist params
2026-02-03 17:58:55 - claudetube-58qv: Verified fix already in main (6d85ec6), closed
- 2026-02-03 17:59 | claudetube-8lw5 [P1] | extract_entities returns empty arrays - no actual vision analysis
- 2026-02-03 18:09 | claudetube-lx2j [P2] | Whisper SRT segments too long (30+ seconds)
- 2026-02-03 18:17 | claudetube-n6dp [P2] | Standardize transcript file naming convention
2026-02-03 18:21 - claudetube-n6dp CLOSED - Standardized transcript file naming documentation
- 2026-02-03 18:21 | claudetube-isum [P2] | watch_video_tool answer synthesis fails to extract correct info
2026-02-03 18:45 - claudetube-isum CLOSED - Fixed answer synthesis to extract relevant content and prefer relevant answers
- 2026-02-04 08:08 | claudetube-0na5 [P1] | Split vector DB from metadata DB
- 2026-02-04 08:24 | claudetube-4ikn [P1] | Consolidate data root to ~/.claudetube
- 2026-02-04 08:33 | claudetube-imjz [P2] | Make SQLite authoritative source of truth
