# Ralph Progress Log

## 2026-02-03

### claudetube-amqw: MCP server cache resolution differs from direct Python
**Status:** Closed (Already Fixed)

Investigated the reported bug where MCP tool calls returned "Video not found" while direct Python worked.

**Finding:** The bug was already fixed in commit f5257a9 (claudetube-q241).

**Root cause:** SQLite returned stale `cache_path` values that no longer existed on disk after videos were moved to hierarchical paths.

**Fix applied (in f5257a9):**
- SQLite lookup now verifies `state.json` exists before trusting the cache_path
- Falls back to flat path check and glob scan if SQLite path is stale
- Added `require_cached()` method for MCP tools to fail fast with clear errors
- `list_cached_videos()` now combines SQL + filesystem results

**Verification:**
- Tested MCP tool call: `get_transcript('aircAruvnKk')` → SUCCESS
- Tested direct Python: `asyncio.run(get_transcript('aircAruvnKk', 'txt'))` → SUCCESS
- Both return 18,505 char transcript correctly
- 2026-02-03 17:04 | claudetube-58qv [P1] | JSON parse error on URLs with playlist params
- 2026-02-03 17:09 | claudetube-r5zk [P2] | Fix 5 failing tests in entity_extraction and visual_transcript operations
